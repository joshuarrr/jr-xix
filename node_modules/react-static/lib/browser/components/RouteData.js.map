{"version":3,"sources":["../../../src/browser/components/RouteData.js"],"names":["instances","global","reloadAll","forEach","instance","safeForceUpdate","RouteData","unmounted","forceUpdate","push","filter","d","props","children","Loader","routePath","routeError","routeErrorByPath","routeInfo","routeInfoByPath","data","Error","Promise","all","priority","resolve","setTimeout","process","env","REACT_STATIC_MIN_LOAD_TIME","React","Component","Spinner","withRouteData","Comp","opts","routeData"],"mappings":"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","sourcesContent":["import React from 'react'\n\nimport { prefetch, routeInfoByPath, routeErrorByPath } from '../'\nimport Spinner from './Spinner'\nimport { withStaticInfo } from './StaticInfo'\nimport { withRoutePathContext } from './Routes'\n\nlet instances = []\n\nglobal.reloadAll = () => {\n  instances.forEach(instance => instance.safeForceUpdate())\n}\n\nconst RouteData = withStaticInfo(\n  withRoutePathContext(\n    class RouteData extends React.Component {\n      static defaultProps = {\n        Loader: Spinner,\n      }\n      componentDidMount() {\n        instances.push(this)\n      }\n      componentWillUnmount() {\n        instances = instances.filter(d => d !== this)\n        this.unmounted = true\n      }\n      safeForceUpdate = () => {\n        if (this.unmounted) {\n          return\n        }\n        this.forceUpdate()\n      }\n      render() {\n        const { children, Loader, routePath } = this.props\n\n        const routeError = routeErrorByPath[routePath]\n        const routeInfo = routeError\n          ? routeInfoByPath['404']\n          : routeInfoByPath[routePath]\n\n        // If there was an error reported for this path, throw an error\n        // unless there is data for the 404 page\n        if (routeError && (!routeInfo || !routeInfo.data)) {\n          throw new Error(\n            `React-Static: <RouteData> could not find any data for this route: ${routePath}. If this is a dynamic route, please remove any reliance on RouteData or withRouteData from this routes components`\n          )\n        }\n\n        // If we haven't requested the routeInfo yet, or it's loading\n        // Show a spinner and prefetch the data\n        // TODO:suspense - This will become a suspense resource\n        if (!routeInfo || !routeInfo.data) {\n          ;(async () => {\n            await Promise.all([\n              prefetch(routePath, { priority: true }),\n              new Promise(resolve =>\n                setTimeout(resolve, process.env.REACT_STATIC_MIN_LOAD_TIME)\n              ),\n            ])\n            this.safeForceUpdate()\n          })()\n          return <Loader />\n        }\n\n        // Otherwise, get it from the routeInfoByPath (subsequent client side)\n        return children(routeInfo.data)\n      }\n    }\n  )\n)\n\nexport default RouteData\n\nexport function withRouteData(Comp, opts = {}) {\n  return props => (\n    <RouteData {...opts}>\n      {routeData => <Comp {...routeData} {...props} />}\n    </RouteData>\n  )\n}\n"],"file":"RouteData.js"}