{"version":3,"sources":["../../src/static/exportRoute.js"],"names":["cachedBasePath","cachedHrefReplace","cachedSrcReplace","config","Comp","DocumentTemplate","route","siteData","clientStats","incremental","sharedHashesByProp","template","data","sharedData","routePath","path","remove","Error","removeLocation","nodePath","join","paths","DIST","fs","basePath","hrefReplace","RegExp","srcReplace","routeInfo","embeddedRouteInfo","renderMeta","chunkNames","head","clientScripts","clientStyleSheets","clientCss","disableRuntime","redirect","FinalComp","props","chunkName","startsWith","ROOT","push","renderToStringAndExtract","comp","appHtml","scripts","stylesheets","css","helmet","Helmet","renderStatic","htmlProps","htmlAttributes","toComponent","bodyProps","bodyAttributes","base","link","meta","noscript","script","style","title","beforeRenderToElementHook","plugins","renderToElement","RenderedComp","beforeRenderToHtml","renderToHtml","beforeHtmlToDocument","message","component","renderToStaticMarkup","__html","DocumentHtml","html","beforeDocumentToFile","publicPath","process","env","REACT_STATIC_PUBLIC_PATH","REACT_STATIC_DISABLE_ROUTE_PREFIXING","replace","htmlFilename","routeInfoFilename","Promise","all","outputFile","outputJson","resolve","res","exportRoute"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { renderToString, renderToStaticMarkup } from 'react-dom/server'\nimport Helmet from 'react-helmet'\nimport { ReportChunks } from 'react-universal-component'\nimport flushChunks from 'webpack-flush-chunks'\nimport nodePath from 'path'\nimport fs from 'fs-extra'\n\nimport Redirect from './components/Redirect'\nimport { makePathAbsolute, makeHookReducer } from '../utils'\nimport { absoluteToRelativeChunkName } from '../utils/chunkBuilder'\n\nimport { makeHtmlWithMeta } from './components/HtmlWithMeta'\nimport { makeHeadWithMeta } from './components/HeadWithMeta'\nimport { makeBodyWithMeta } from './components/BodyWithMeta'\n\n//\n\nlet cachedBasePath\nlet cachedHrefReplace\nlet cachedSrcReplace\n\nexport default (async function exportRoute({\n  config,\n  Comp,\n  DocumentTemplate,\n  route,\n  siteData,\n  clientStats,\n  incremental,\n}) {\n  const {\n    sharedHashesByProp,\n    template,\n    data,\n    sharedData,\n    path: routePath,\n    remove,\n  } = route\n\n  if (incremental && remove) {\n    if (route.path === '404' || route.path === '/') {\n      throw new Error(\n        `You are attempting to incrementally remove the ${\n          route.path === '404' ? '404' : 'index'\n        } route from your export. This is currently not supported (or recommended) by React Static.`\n      )\n    }\n    const removeLocation = nodePath.join(config.paths.DIST, route.path)\n    return fs.remove(removeLocation)\n  }\n\n  const basePath = cachedBasePath || (cachedBasePath = config.basePath)\n\n  const hrefReplace =\n    cachedHrefReplace ||\n    (cachedHrefReplace = new RegExp(\n      `(href=[\"'])\\\\/(${basePath ? `${basePath}\\\\/` : ''})?([^\\\\/])`,\n      'gm'\n    ))\n\n  const srcReplace =\n    cachedSrcReplace ||\n    (cachedSrcReplace = new RegExp(\n      `(src=[\"'])\\\\/(${basePath ? `${basePath}\\\\/` : ''})?([^\\\\/])`,\n      'gm'\n    ))\n\n  // This routeInfo will be saved to disk. It should only include the\n  // data and hashes to construct all of the props later.\n  const routeInfo = {\n    template,\n    sharedHashesByProp,\n    data,\n    path: routePath,\n  }\n\n  // This embeddedRouteInfo will be inlined into the HTML for this route.\n  // It should include all of the data, including shared data\n  const embeddedRouteInfo = {\n    ...routeInfo,\n    sharedData,\n    siteData,\n  }\n\n  // Make a place to collect chunks, meta info and head tags\n  const renderMeta = {}\n  const chunkNames = []\n  let head = {}\n  let clientScripts = []\n  let clientStyleSheets = []\n  let clientCss = {}\n\n  let FinalComp\n\n  // Get the react component from the Comp and\n  // pass it the export context. This uses\n  // reactContext under the hood to pass down\n  // the exportContext, since react's new context\n  // api doesn't survive across bundling.\n  Comp = config.disableRuntime ? Comp : Comp(embeddedRouteInfo)\n\n  if (route.redirect) {\n    FinalComp = () => <Redirect fromPath={route.path} to={route.redirect} />\n  } else {\n    FinalComp = props => (\n      <ReportChunks\n        report={chunkName => {\n          // if we are building to a absolute path we must make the detected chunkName relative and matching to the one we set in generateTemplates\n          if (!config.paths.DIST.startsWith(config.paths.ROOT)) {\n            chunkName = absoluteToRelativeChunkName(\n              config.paths.ROOT,\n              chunkName\n            )\n          }\n\n          chunkNames.push(chunkName)\n        }}\n      >\n        <Comp {...props} />\n      </ReportChunks>\n    )\n  }\n\n  const renderToStringAndExtract = comp => {\n    // Rend the app to string!\n    const appHtml = renderToString(comp)\n    const { scripts, stylesheets, css } = flushChunks(clientStats, {\n      chunkNames,\n    })\n\n    clientScripts = scripts\n    clientStyleSheets = stylesheets\n    clientCss = css\n    // Extract head calls using Helmet synchronously right after renderToString\n    // to not introduce any race conditions in the meta data rendering\n    const helmet = Helmet.renderStatic()\n    head = {\n      htmlProps: helmet.htmlAttributes.toComponent(),\n      bodyProps: helmet.bodyAttributes.toComponent(),\n      base: helmet.base.toComponent(),\n      link: helmet.link.toComponent(),\n      meta: helmet.meta.toComponent(),\n      noscript: helmet.noscript.toComponent(),\n      script: helmet.script.toComponent(),\n      style: helmet.style.toComponent(),\n      title: helmet.title.toComponent(),\n    }\n\n    return appHtml\n  }\n\n  let appHtml\n\n  try {\n    const beforeRenderToElementHook = makeHookReducer(\n      config.plugins,\n      'beforeRenderToElement'\n    )\n    FinalComp = await beforeRenderToElementHook(FinalComp, {\n      config,\n      meta: renderMeta,\n    })\n\n    if (config.renderToElement) {\n      throw new Error(\n        `config.renderToElement has been deprecated in favor of the 'beforeRenderToElement' or 'beforeRenderToHtml' hooks instead.`\n      )\n    }\n\n    let RenderedComp = <FinalComp />\n\n    // Run the beforeRenderToHtml hook\n    // Rum the Html hook\n    const beforeRenderToHtml = makeHookReducer(\n      config.plugins,\n      'beforeRenderToHtml'\n    )\n    RenderedComp = await beforeRenderToHtml(RenderedComp, {\n      config,\n      meta: renderMeta,\n    })\n\n    if (config.renderToHtml) {\n      throw new Error(\n        `config.renderToHtml has been deprecated in favor of the 'beforeRenderToHtml' or 'beforeHtmlToDocument' hooks instead.`\n      )\n    }\n\n    appHtml = renderToStringAndExtract(RenderedComp)\n\n    // Rum the beforeHtmlToDocument hook\n    const beforeHtmlToDocument = makeHookReducer(\n      config.plugins,\n      'beforeHtmlToDocument'\n    )\n    appHtml = await beforeHtmlToDocument(appHtml, { config, meta: renderMeta })\n  } catch (error) {\n    error.message = `Failed exporting HTML for URL ${route.path} (${\n      route.component\n    }): ${error.message}`\n    throw error\n  }\n\n  const DocumentHtml = renderToStaticMarkup(\n    <DocumentTemplate\n      Html={makeHtmlWithMeta({ head })}\n      Head={\n        await makeHeadWithMeta({\n          head,\n          route,\n          clientScripts,\n          config,\n          clientStyleSheets,\n          clientCss,\n          meta: renderMeta,\n        })\n      }\n      Body={makeBodyWithMeta({\n        head,\n        route,\n        embeddedRouteInfo,\n        clientScripts,\n        config,\n      })}\n      siteData={siteData}\n      routeInfo={embeddedRouteInfo}\n      renderMeta={renderMeta}\n    >\n      <div id=\"root\" dangerouslySetInnerHTML={{ __html: appHtml }} />\n    </DocumentTemplate>\n  )\n\n  // Render the html for the page inside of the base document.\n  let html = `<!DOCTYPE html>${DocumentHtml}`\n\n  // Rum the beforeDocumentToFile hook\n  const beforeDocumentToFile = makeHookReducer(\n    config.plugins,\n    'beforeDocumentToFile'\n  )\n  html = await beforeDocumentToFile(html, { meta: renderMeta })\n\n  // If the siteRoot is set and we're not in staging, prefix all absolute URLs\n  // with the siteRoot\n  const publicPath = makePathAbsolute(process.env.REACT_STATIC_PUBLIC_PATH)\n  if (process.env.REACT_STATIC_DISABLE_ROUTE_PREFIXING !== 'true') {\n    html = html.replace(hrefReplace, `$1${publicPath}$3`)\n  }\n\n  html = html.replace(srcReplace, `$1${publicPath}$3`)\n\n  // If the route is a 404 page, write it directly to 404.html, instead of\n  // inside a directory.\n  const htmlFilename =\n    route.path === '404'\n      ? nodePath.join(config.paths.DIST, '404.html')\n      : nodePath.join(config.paths.DIST, route.path, 'index.html')\n\n  // Make the routeInfo sit right next to its companion html file\n  const routeInfoFilename = nodePath.join(\n    config.paths.DIST,\n    route.path,\n    'routeInfo.json'\n  )\n\n  const res = await Promise.all([\n    fs.outputFile(htmlFilename, html),\n    !route.redirect\n      ? fs.outputJson(routeInfoFilename, routeInfo)\n      : Promise.resolve(),\n  ])\n  return res\n})\n"],"file":"exportRoute.js"}